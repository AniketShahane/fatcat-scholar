
{% macro fulltext_search_result_row(paper) -%}
{% set lang_code = "en" %}
<div class="ui grid">
<div class="thirteen wide column">
  {# ### TITLE ROW #}
  <div style="margin-bottom: 0.1em; font-size: 1.2em; font-weight: bold;">

    {% if paper.doc_type == "work" %}
      {# "best URL" calculation #}
      {% if paper.biblio.pmcid %}
      <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/{{ paper.biblio.pmcid }}/"
      {% elif paper.biblio.pmid %}
      <a href="https://pubmed.ncbi.nlm.nih.gov/{{ paper.biblio.pmid }}/"
      {% elif paper.biblio.arxiv_id %}
      <a href="https://arxiv.org/abs/{{ paper.biblio.arxiv_id }}/"
      {% elif paper.biblio.doi %}
      <a href="https://doi.org/{{ paper.biblio.doi }}"
      {% else %}
      <a href="https://fatcat.wiki/release/{{ paper.biblio.fatcat_ident }}"
      {% endif %}
      style="color: #2224c7;">
        {% if paper.biblio.title %}
          {{ paper.biblio.title[:512] }}
          {% if paper.biblio.title|length > 512 %}...{% endif %}
        {% else %}
          [blank]
        {% endif %}
      </a>
      {# release type suffix #}
      <span style="font-weight: normal; text-transform: uppercase; font-weight: bold;">
      {% if paper.biblio.release_type in ("article-journal", "paper-conference") or paper.doc_type == "sim_page" %}
        {# pass #}
      {% elif paper.biblio.release_type in ("book", "chapter", "dataset") %}
        [{{ _(paper.biblio.release_type) }}]
      {% elif not paper.biblio.release_type %}
        <span style="color: red;">[media?]</span>
      {% else %}
        [{{ _(paper.biblio.release_type) }}]
      {% endif %}
      </span>

      {# show inverse of title/original_title above #}
      {% if paper.biblio.original_title and paper.biblio.title != paper.biblio.original_title %}
        <br>
        <i style="font-weight: bold;">
          {{ paper.biblio.original_title[:512] }} {% if paper.biblio.original_title|length > 512 %}...{% endif %}
        </i>
      {% endif %}

    {% elif paper.doc_type == "sim_page" %}
      <a href="https://archive.org/details/{{ paper.ia_sim.issue_item }}/page/{{ paper.ia_sim.first_page }}" style="color: #2224c7;">Page {{ paper.ia_sim.first_page }}</a> of <a href="https://archive.org/details/{{ paper.ia_sim.issue_item }}" style="color: #2224c7;">{{ paper.biblio.container_name }}</a> (<a href="https://archive.org/details/{{ paper.ia_sim.issue_item }}" style="color: #2224c7;">Vol. {{ paper.biblio.volume }}, Issue {{ paper.biblio.issue }}</a>)
    {% endif %}

  </div>

  {# ### AUTHOR ROW #}
  {% if paper.biblio.contrib_names %}
    <div style="margin-top: 0.1em; margin-bottom: 0.2em; font-size: 1.1em;">
    {{ ", ".join(paper.biblio.contrib_names[:12]) }}
    {% if paper.biblio.contrib_names|length > 12 %}<i>(+{{ paper.biblio.contrib_names|length - 12 }} others)</i>{% endif %}
    </div>
  {% endif %}


  {# ### JOURNAL ROW #}
  {% if paper.biblio.release_year %}
    {{ paper.biblio.release_year }}
  {% endif %}
  {% if paper.biblio.release_year and paper.biblio.container_name %}
    
  {% endif %}
  {% if paper.biblio.container_name %}
    <i>
    {% if paper.biblio.container_id %}
      <a href="https://fatcat.wiki/container/{{ paper.biblio.container_id }}" style="color: black;">{{ paper.biblio.container_name }}</a>
    {% elif paper.doc_type == "sim_page" %}
      <a href="https://archive.org/details/{{ paper.ia_sim.pub_collection }}" style="color: black;">{{ paper.biblio.container_name }}</a>
    {% else %}
      {{ paper.biblio.container_name }}
    {% endif %}
    </i>
    {% if paper.container_is_oa %}<i class="icon unlock orange small"></i>{% endif %}
  {% endif %}
  {% if paper.biblio.withdrawn_status %}
    <b style="color: red;"><code>[{{ paper.biblio.withdrawn_status }}]</code></b>
  {% endif %}
  {% if paper.biblio.release_stage == "accepted" %}
    <b style="color: brown;"><code>[{{ paper.biblio.release_stage }}]</code></b>
  {% elif paper.biblio.release_stage and paper.biblio.release_stage != "published" %}
    <b style="color: red;"><code>[{{ paper.biblio.release_stage }}]</code></b>
  {% elif not paper.biblio.release_stage %}
    <b style="color: red;"><code>[unpublished?]</code></b>
  {% endif %}

  {# ### ABSTRACT / QUERY HIGHLIGHT #}
  {% if paper._highlights %}
    <div style="padding-top: 1em; padding-bottom: 0.5em;" class="search_highlights">
    {% for highlight in paper._highlights %}
      {{ highlight|safe }} &nbsp;...&nbsp;
    {% endfor %}
    </div>
  {% elif paper.abstracts %}
    <div style="padding-top: 1em; padding-bottom: 0.5em;">
      {% if paper.abstracts[0].body|length > 500 %}
        {{ paper.abstracts[0].body[:500] }}...
      {% else %}
        {{ paper.abstracts[0].body[:500] }}...
      {% endif %}
    </div>
  {% else %}
    <br>
  {% endif %}

  {# ### IDENTIFIERS #}
  {% if paper.biblio.doi %}
    <a href="https://doi.org/{{paper.biblio.doi }}" style="color: green;">doi:{{ paper.biblio.doi }}</a> &nbsp;
  {% endif %}
  {% if paper.biblio.pmid %}
    <a href="https://www.ncbi.nlm.nih.gov/pubmed/{{paper.biblio.pmid }}" style="color: green;">pmid:{{ paper.biblio.pmid }}</a> &nbsp;
  {% endif %}
  {% if paper.biblio.pmcid %}
    <a href="https://pubmed.ncbi.nlm.nih.gov/{{paper.biblio.pmcid }}/" style="color: green;">pmcid:{{ paper.pmcid }}</a> &nbsp;
  {% endif %}
  {% if paper.biblio.arxiv_id %}
    <a href="https://arxiv.org/abs/{{paper.biblio.arxiv_id }}" style="color: green;">arXiv:{{ paper.biblio.arxiv_id }}</a> &nbsp;
  {% endif %}
  {% if paper.biblio.fatcat_ident %}
    <a href="https://fatcat.wiki/release/{{paper.biblio.fatcat_ident}}" style="color: green;">fatcat:{{ paper.biblio.fatcat_ident}}</a> &nbsp;
  {% endif %}

  {# ### SOURCE TAGS #}
  <div style="margin-top: 0.2em;">
  {% for tag in paper.tags %}
    <span class="ui label small">{{ tag }}</span>
  {% endfor %}
  {# olive, brown, grey, pink, red, etc #}
  </div>

</div>
<div class="three wide left aligned column" style="padding-top: 0em; padding-right: 0em;">
  {% if paper.fulltext.access_url %}
      {# <img src="{{ settings.COVID19_FULLTEXT_HOST }}{{ paper.fulltext.thumbnail_url }}" style="border: 1px solid grey; max-height: 12em; max-width: 100%;"> #}
    {% if paper.fulltext.thumbnail_url %}
      <div class="ui card" style="margin-bottom: 0.4em;">
        <a class="image" href="{{ paper.fulltext.access_url}}">
          <img src="{{ paper.fulltext.thumbnail_url }}">
        </a>
      </div>
    {% endif %}
    <a href="{{ paper.fulltext.access_url}}">
      <div style="width: 100%; padding-left: 0.5em; padding-right: 0.5em; opacity: 0.5; text-align: center;">
        {# TODO: could have other hover info, like mimetype icon and file size? #}
        <span>
        {% if paper.fulltext.access_type == "wayback" %}
          web.archive.org
        {% elif paper.fulltext.access_type in ["ia_sim", "ia_file"] %}
          archive.org
        {% endif %}
        {% if paper.fulltext.file_mimetype == "application/pdf" %}
          <i class="file pdf outline icon"></i>
        {% elif paper.fulltext.access_type == "ia_sim" %}
          <i class="film icon"></i>
        {% endif %}
        </span>
      </div>
    </a>
  {% else %}
    {# No Fulltext #}
  {% endif %}
</div>
</div>
{% endmacro %}
